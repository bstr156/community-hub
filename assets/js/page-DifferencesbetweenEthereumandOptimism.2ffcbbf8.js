(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{788:function(e,t,s){"use strict";s.r(t);var a=s(2),r=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("It's important to note that there are various minor discrepancies between the behavior of Optimism and Ethereum.\nYou should be aware of these descrepancies when building apps on top of Optimism.")]),e._v(" "),t("h2",{attrs:{id:"opcode-differences"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#opcode-differences"}},[e._v("#")]),e._v(" Opcode Differences")]),e._v(" "),t("h3",{attrs:{id:"modified-opcodes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#modified-opcodes"}},[e._v("#")]),e._v(" Modified Opcodes")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Opcode")]),e._v(" "),t("th",[e._v("Solidity equivalent")]),e._v(" "),t("th",[e._v("Behavior")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[t("code",[e._v("COINBASE")])]),e._v(" "),t("td",[t("code",[e._v("block.coinbase")])]),e._v(" "),t("td",[e._v("Value is set by the sequencer. Currently returns the "),t("code",[e._v("OVM_SequencerFeeVault")]),e._v(" address ("),t("code",[e._v("0x420...011")]),e._v(").")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("DIFFICULTY")])]),e._v(" "),t("td",[t("code",[e._v("block.difficulty")])]),e._v(" "),t("td",[e._v("Always returns zero. "),t("RouterLink",{attrs:{to:"/docs/useful-tools/oracles.html#verifiable-randomness-function-vrf"}},[e._v("You can use an oracle for randomness")]),e._v(".")],1)]),e._v(" "),t("tr",[t("td",[t("code",[e._v("BASEFEE")])]),e._v(" "),t("td",[t("code",[e._v("block.basefee")])]),e._v(" "),t("td",[e._v("Currently unsupported.")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("ORIGIN")])]),e._v(" "),t("td",[t("code",[e._v("tx.origin")])]),e._v(" "),t("td",[e._v("If the transaction is an L1 ⇒ L2 transaction, then "),t("code",[e._v("tx.origin")]),e._v(" is set to the "),t("a",{attrs:{href:"#address-aliasing"}},[e._v("aliased address")]),e._v(" of the address that triggered the L1 ⇒ L2 transaction. Otherwise, this opcode behaves normally.")])])])]),e._v(" "),t("h3",{attrs:{id:"added-opcodes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#added-opcodes"}},[e._v("#")]),e._v(" Added Opcodes")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Opcode")]),e._v(" "),t("th",[e._v("Behavior")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[t("code",[e._v("L1BLOCKNUMBER")])]),e._v(" "),t("td",[e._v("Returns the block number of the last L1 block known by the L2 system. Typically this block number will lag by up to 15 minutes behind the actual latest L1 block number. See section on "),t("a",{attrs:{href:"#block-numbers-and-timestamps"}},[e._v("Block Numbers and Timestamps")]),e._v(" for more information.")])])])]),e._v(" "),t("h2",{attrs:{id:"block-numbers-and-timestamps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#block-numbers-and-timestamps"}},[e._v("#")]),e._v(" Block Numbers and Timestamps")]),e._v(" "),t("h3",{attrs:{id:"block-production-is-not-constant"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#block-production-is-not-constant"}},[e._v("#")]),e._v(" Block production is not constant")]),e._v(" "),t("p",[e._v("On Ethereum, the "),t("code",[e._v("NUMBER")]),e._v(" opcode ("),t("code",[e._v("block.number")]),e._v(" in Solidity) corresponds to the current Ethereum block number.\nSimilarly, in Optimism, "),t("code",[e._v("block.number")]),e._v(" corresponds to the current L2 block number.\nHowever, as of the OVM 2.0 release of Optimism (Nov. 2021), "),t("strong",[e._v("each transaction on L2 is placed in a separate block and blocks are NOT produced at a constant rate.")])]),e._v(" "),t("p",[e._v("This is important because it means that "),t("code",[e._v("block.number")]),e._v(" is currently NOT a reliable source of timing information.\nIf you want access to the current time, you should use "),t("code",[e._v("block.timestamp")]),e._v(" (the "),t("code",[e._v("TIMESTAMP")]),e._v(" opcode) instead.")]),e._v(" "),t("h3",{attrs:{id:"timestamps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#timestamps"}},[e._v("#")]),e._v(" Timestamps")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("TIMESTAMP")]),e._v(" opcode ("),t("code",[e._v("block.timestamp")]),e._v(" in Solidity) uses the timestamp of the transaction itself. It gets updated every fifteen seconds.")]),e._v(" "),t("h3",{attrs:{id:"accessing-the-latest-l1-block-number"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#accessing-the-latest-l1-block-number"}},[e._v("#")]),e._v(" Accessing the latest L1 block number")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("NOTICE")]),e._v(" "),t("p",[e._v("The hex value that corresponds to the "),t("code",[e._v("L1BLOCKNUMBER")]),e._v(" opcode ("),t("code",[e._v("0x4B")]),e._v(") may be changed in the future (pending further discussion).\n"),t("strong",[e._v("We strongly discourage direct use of this opcode within your contracts.")]),e._v("\nInstead, if you want to access the latest L1 block number, please use the "),t("code",[e._v("OVM_L1BlockNumber")]),e._v(" contract as described below.")])]),e._v(" "),t("p",[e._v("The block number of the latest L1 block seen by the L2 system can be accessed via the "),t("code",[e._v("L1BLOCKNUMBER")]),e._v(" opcode.\nSolidity doesn't make it easy to use non-standard opcodes, so we've created a simple contract located at "),t("a",{attrs:{href:"https://explorer.optimism.io/address/0x4200000000000000000000000000000000000013",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("0x4200000000000000000000000000000000000013")]),t("OutboundLink")],1),e._v(" that will allow you to trigger this opcode.")]),e._v(" "),t("p",[e._v("You can use this contract as follows:")]),e._v(" "),t("div",{staticClass:"language-solidity line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" iOVM_L1BlockNumber "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"@eth-optimism/contracts/L2/predeploys/iOVM_L1BlockNumber.sol"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" Lib_PredeployAddresses "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"@eth-optimism/contracts/libraries/constants/Lib_PredeployAddresses.sol"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("contract")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MyContract")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("myFunction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ... your code here ...")]),e._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" l1BlockNumber "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("iOVM_L1BlockNumber")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n         Lib_PredeployAddresses"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("L1_BLOCK_NUMBER "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// located at 0x4200000000000000000000000000000000000013")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getL1BlockNumber")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ... your code here ...")]),e._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br")])]),t("h2",{attrs:{id:"using-eth-in-contracts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-eth-in-contracts"}},[e._v("#")]),e._v(" Using ETH in Contracts")]),e._v(" "),t("p",[e._v("As of the OVM 2.0 update (Nov. 2021), "),t("strong",[e._v("the process of using ETH on L2 is identical to the process of using ETH in Ethereum.")]),e._v("\nPlease note that ETH was previously accessible as an ERC20 token, but this feature has been removed as part of OVM 2.0.")]),e._v(" "),t("p",[e._v("For tooling developers and infrastructure providers, please note that ETH is still represented internally as an ERC20 token at the address "),t("a",{attrs:{href:"https://explorer.optimism.io/address/0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000")]),t("OutboundLink")],1),e._v(".\nAs a result, user balances will always be zero inside the state trie and the user's actual balance will be stored in the aforementioned token's storage.\n"),t("strong",[e._v("It is NOT possible to call this contract directly, it will throw an error.")])]),e._v(" "),t("h2",{attrs:{id:"address-aliasing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#address-aliasing"}},[e._v("#")]),e._v(" Address Aliasing")]),e._v(" "),t("p",[e._v("Because of the behavior of the "),t("code",[e._v("CREATE")]),e._v(" opcode, it is possible for a user to create a contract on L1 and on L2 that share the same address but have different bytecode.\nThis can break trust assumptions, because one contract may be trusted and another be untrusted (see below).\nTo prevent this problem the behavior of the "),t("code",[e._v("ORIGIN")]),e._v(" and "),t("code",[e._v("CALLER")]),e._v(" opcodes ("),t("code",[e._v("tx.origin")]),e._v(" and "),t("code",[e._v("msg.sender")]),e._v(") differs slightly between L1 and L2.")]),e._v(" "),t("p",[e._v("The value of "),t("code",[e._v("tx.origin")]),e._v(" is determined as follows:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Call source")]),e._v(" "),t("th",[t("code",[e._v("tx.origin")])])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("L2 user (Externally Owned Account)")]),e._v(" "),t("td",[e._v("The user's address (same as in Ethereum)")])]),e._v(" "),t("tr",[t("td",[e._v("L1 user (Externally Owned Account)")]),e._v(" "),t("td",[e._v("The user's address (same as in Ethereum)")])]),e._v(" "),t("tr",[t("td",[e._v("L1 contract (using "),t("code",[e._v("CanonicalTransactionChain.enqueue")]),e._v(")")]),e._v(" "),t("td",[t("code",[e._v("L1_contract_address + 0x1111000000000000000000000000000000001111")])])])])]),e._v(" "),t("p",[e._v("The value of "),t("code",[e._v("msg.sender")]),e._v(" at the top-level (the very first contract being called) is always equal to "),t("code",[e._v("tx.origin")]),e._v(".\nTherefore, if the value of "),t("code",[e._v("tx.origin")]),e._v(" is affected by the rules defined above, the top-level value of "),t("code",[e._v("msg.sender")]),e._v(" will also be impacted.")]),e._v(" "),t("p",[e._v("Note that in general, "),t("a",{attrs:{href:"https://docs.soliditylang.org/en/latest/security-considerations.html#tx-origin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("tx.origin")]),e._v(" should "),t("em",[e._v("not")]),e._v(" be used for authorization"),t("OutboundLink")],1),e._v(".\nHowever, that is a separate issue from address aliasing because address aliasing also affects "),t("code",[e._v("msg.sender")]),e._v(".")]),e._v(" "),t("h3",{attrs:{id:"why-is-address-aliasing-an-issue"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#why-is-address-aliasing-an-issue"}},[e._v("#")]),e._v(" Why is address aliasing an issue?")]),e._v(" "),t("p",[e._v("The problem with two identical source addresses (the L1 contract and the L2 contract) is that we extend trust based on the address.\nIt is possible that we will want to trust one of the contracts, but not the other.")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Helena Hacker forks "),t("a",{attrs:{href:"https://uniswap.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Uniswap"),t("OutboundLink")],1),e._v(" to create her own exchange (on L2), called Hackswap.")]),e._v(" "),t("p",[t("strong",[e._v("Note:")]),e._v(" There are actually multiple contracts in Uniswap, so this explanation is a bit simplified.\n"),t("a",{attrs:{href:"https://ethereum.org/en/developers/tutorials/uniswap-v2-annotated-code/",target:"_blank",rel:"noopener noreferrer"}},[e._v("See here if you want additional details"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("li",[t("p",[e._v("Helena Hacker provides Hackswap with liquidity that appears to provide profitable arbitrage opportunities.\nFor example, she can make it so that you can spend 1 "),t("a",{attrs:{href:"https://www.coindesk.com/price/dai/",target:"_blank",rel:"noopener noreferrer"}},[e._v("DAI"),t("OutboundLink")],1),e._v("to buy 1.1 "),t("a",{attrs:{href:"https://www.coindesk.com/price/tether/",target:"_blank",rel:"noopener noreferrer"}},[e._v("USDT"),t("OutboundLink")],1),e._v(".\nBoth of those coins are supposed to be worth exactly $1.")])]),e._v(" "),t("li",[t("p",[e._v("Nimrod Naive knows that if something looks too good to be true it probably is.\nHowever, he checks the Hackswap contract's bytecode and verifies it is 100% identical to Uniswap.\nHe decides this means the contract can be trusted to behave exactly as Uniswap does.")])]),e._v(" "),t("li",[t("p",[e._v("Nimrod approves an allowance of 1000 DAI for the Hackswap contract.\nNimrod expects to call the swap function on Hackswap and receive back nearly 1100 USDT.")])]),e._v(" "),t("li",[t("p",[e._v("Before Nimrod's swap transaction is sent to the blockchain, Helena Hacker sends a transaction from an L1 contract with the same address as Hackswap.\nThis transaction transfers 1000 DAI from Nimrod's address to Helena Hacker's address.\nIf this transaction were to come from the same address as Hackswap on L2, it would be able to transfer the 1000 DAI because of the allowance Nimrod "),t("em",[e._v("had")]),e._v(" to give Hackswap in the previous step to swap tokens.")]),e._v(" "),t("p",[e._v("Nimrod, despite his naivete, is protected because Optimism modified the transaction's "),t("code",[e._v("tx.origin")]),e._v(" (which is also the initial "),t("code",[e._v("msg.sender")]),e._v(").\nThat transaction comes from a "),t("em",[e._v("different")]),e._v(" address, one that does not have the allowance.")])])]),e._v(" "),t("p",[t("strong",[e._v("Note:")]),e._v(" It is simple to create two different contracts on the same address in different chains.\nBut it is nearly impossible to create two that are different by a specified amount, so Helena Hacker can't do that.")]),e._v(" "),t("h2",{attrs:{id:"network-specifications"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#network-specifications"}},[e._v("#")]),e._v(" Network specifications")]),e._v(" "),t("h3",{attrs:{id:"json-rpc-differences"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#json-rpc-differences"}},[e._v("#")]),e._v(" JSON-RPC differences")]),e._v(" "),t("p",[e._v("Optimism uses the same "),t("a",{attrs:{href:"https://eth.wiki/json-rpc/API",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON-RPC API"),t("OutboundLink")],1),e._v(" as Ethereum.\nSome additional Optimism specific methods have been introduced.\nSee the full list of "),t("RouterLink",{attrs:{to:"/docs/rollux-developers/build/json-rpc.html"}},[e._v("custom JSON-RPC methods")]),e._v(" for more information.")],1),e._v(" "),t("h3",{attrs:{id:"pre-eip-155-support"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pre-eip-155-support"}},[e._v("#")]),e._v(" Pre-EIP-155 support")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://eips.ethereum.org/EIPS/eip-155",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pre-EIP-155"),t("OutboundLink")],1),e._v(" transactions do not have a chain ID, which means a transaction on one Ethereum blockchain can be replayed on others.\nThis is a security risk, because transactions that are legitimate on one chain could be a security risk on another.\nFor example, you might agree to send me 1 ETH on Goerli (chain ID 5) to help me test my contracts.\nIf you submit the transaction as a pre-EIP-155 transaction, then I can wait until your address's nonce on mainnet (chain ID 1) is the same as the one you had when you submitted the Goerli transaction and send the transaction to mainnet.\nMainnet would then interpret it as a legitimate transaction and transfer a "),t("em",[e._v("real")]),e._v(" ETH from your account to mine (assuming your balance is high enough, of course)")]),e._v(" "),t("p",[e._v("Starting in November 2022, pre-EIP-155 transactions are no longer supported on Optimism using the public endpoint or through Alchemy.")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("Pre-EIP-155 transactions are dangerous")]),e._v(" "),t("p",[e._v("It is highly recommended not to use pre-eip-155 transaction.\nBut if you absolutely must use them, "),t("RouterLink",{attrs:{to:"/docs/useful-tools/providers.html#infura"}},[e._v("Infura")]),e._v(" and "),t("RouterLink",{attrs:{to:"/docs/useful-tools/providers.html#quicknode"}},[e._v("QuickNode")]),e._v(" still support them.\nJust be careful.")],1)]),e._v(" "),t("h1",{attrs:{id:"bedrock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bedrock"}},[e._v("#")]),e._v(" Bedrock")]),e._v(" "),t("p",[e._v("In "),t("RouterLink",{attrs:{to:"/docs/rollux-developers/bedrock/how-is-bedrock-different.html"}},[e._v("the Bedrock version")]),e._v(" there are even less differences between Optimism and L1 Ethereum.")],1),e._v(" "),t("h2",{attrs:{id:"opcode-differences-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#opcode-differences-2"}},[e._v("#")]),e._v(" Opcode Differences")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Opcode")]),e._v(" "),t("th",[e._v("Solidity equivalent")]),e._v(" "),t("th",[e._v("Behavior")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[t("code",[e._v("COINBASE")])]),e._v(" "),t("td",[t("code",[e._v("block.coinbase")])]),e._v(" "),t("td",[e._v("Undefined")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("DIFFICULTY")])]),e._v(" "),t("td",[t("code",[e._v("block.difficulty")])]),e._v(" "),t("td",[e._v("Random value. As this value is set by the sequencer, it is not as reliably random as the L1 equivalent. "),t("RouterLink",{attrs:{to:"/docs/useful-tools/oracles.html#verifiable-randomness-function-vrf"}},[e._v("You can use an oracle for randomness")]),e._v(".")],1)]),e._v(" "),t("tr",[t("td",[t("code",[e._v("NUMBER")])]),e._v(" "),t("td",[t("code",[e._v("block.number")])]),e._v(" "),t("td",[e._v("L2 block number")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("TIMESTAMP")])]),e._v(" "),t("td",[t("code",[e._v("block.timestamp")])]),e._v(" "),t("td",[e._v("Timestamp of the L2 block")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("ORIGIN")])]),e._v(" "),t("td",[t("code",[e._v("tx.origin")])]),e._v(" "),t("td",[e._v("If the transaction is an L1 ⇒ L2 transaction, then "),t("code",[e._v("tx.origin")]),e._v(" is set to the "),t("a",{attrs:{href:"#address-aliasing"}},[e._v("aliased address")]),e._v(" of the address that triggered the L1 ⇒ L2 transaction. Otherwise, this opcode behaves normally.")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("CALLER")])]),e._v(" "),t("td",[t("code",[e._v("msg.sender")])]),e._v(" "),t("td",[e._v("If the transaction is an L1 ⇒ L2 transaction, and this is the initial call (rather than an internal transaction from one contract to another), the same "),t("a",{attrs:{href:"#address-aliasing"}},[e._v("address aliasing")]),e._v(" behavior applies.")])])])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("`tx.origin == msg.sender`")]),e._v(" "),t("p",[e._v("On L1 Ethereum "),t("code",[e._v("tx.origin")]),e._v(" is equal to "),t("code",[e._v("msg.sender")]),e._v(" only when the smart contract was called directly from an externally owned account (EOA).\nHowever, on Optimism "),t("code",[e._v("tx.origin")]),e._v(" is the origin "),t("em",[e._v("on Optimism")]),e._v(".\nIt could be an EOA.\nHowever, in the case of messages from L1, it is possible for a message from a smart contract on L1 to appear on L2 with "),t("code",[e._v("tx.origin == msg.origin")]),e._v(".\nThis is unlikely to make a significant difference, because an L1 smart contract cannot directly manipulate the L2 state.\nHowever, there could be edge cases we did not think about where this matters.")])]),e._v(" "),t("h3",{attrs:{id:"accessing-l1-information"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#accessing-l1-information"}},[e._v("#")]),e._v(" Accessing L1 information")]),e._v(" "),t("p",[e._v("If you need the equivalent information from the latest L1 block, you can get it from "),t("a",{attrs:{href:"https://github.com/ethereum-optimism/optimism/blob/develop/packages/contracts-bedrock/contracts/L2/L1Block.sol",target:"_blank",rel:"noopener noreferrer"}},[e._v("the "),t("code",[e._v("L1Block")]),e._v(" contract"),t("OutboundLink")],1),e._v(".\nThis contract is a predeploy at address "),t("a",{attrs:{href:"https://goerli-optimism.etherscan.io/address/0x4200000000000000000000000000000000000015",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("0x4200000000000000000000000000000000000015")]),t("OutboundLink")],1),e._v(".\nYou can use "),t("a",{attrs:{href:"https://docs.soliditylang.org/en/v0.8.12/contracts.html#getter-functions",target:"_blank",rel:"noopener noreferrer"}},[e._v("the getter functions"),t("OutboundLink")],1),e._v(" to get these parameters:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("number")]),e._v(": The latest L1 block number known to L2")]),e._v(" "),t("li",[t("code",[e._v("timestamp")]),e._v(": The timestamp of the latest L1 block")]),e._v(" "),t("li",[t("code",[e._v("basefee")]),e._v(": The base fee of the latest L1 block")]),e._v(" "),t("li",[t("code",[e._v("hash")]),e._v(": The hash of the latest L1 block")]),e._v(" "),t("li",[t("code",[e._v("sequenceNumber")]),e._v(": The number of the L2 block within the epoch (the epoch changes when there is a new L1 block)")])]),e._v(" "),t("h3",{attrs:{id:"address-aliasing-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#address-aliasing-2"}},[e._v("#")]),e._v(" Address Aliasing")]),e._v(" "),t("details",[t("p",[e._v("Because of the behavior of the "),t("code",[e._v("CREATE")]),e._v(" opcode, it is possible for a user to create a contract on L1 and on L2 that share the same address but have different bytecode.\nThis can break trust assumptions, because one contract may be trusted and another be untrusted (see below).\nTo prevent this problem the behavior of the "),t("code",[e._v("ORIGIN")]),e._v(" and "),t("code",[e._v("CALLER")]),e._v(" opcodes ("),t("code",[e._v("tx.origin")]),e._v(" and "),t("code",[e._v("msg.sender")]),e._v(") differs slightly between L1 and L2.")]),e._v(" "),t("p",[e._v("The value of "),t("code",[e._v("tx.origin")]),e._v(" is determined as follows:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Call source")]),e._v(" "),t("th",[t("code",[e._v("tx.origin")])])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("L2 user (Externally Owned Account)")]),e._v(" "),t("td",[e._v("The user's address (same as in Ethereum)")])]),e._v(" "),t("tr",[t("td",[e._v("L1 user (Externally Owned Account)")]),e._v(" "),t("td",[e._v("The user's address (same as in Ethereum)")])]),e._v(" "),t("tr",[t("td",[e._v("L1 contract (using "),t("code",[e._v("CanonicalTransactionChain.enqueue")]),e._v(")")]),e._v(" "),t("td",[t("code",[e._v("L1_contract_address + 0x1111000000000000000000000000000000001111")])])])])]),e._v(" "),t("p",[e._v("The value of "),t("code",[e._v("msg.sender")]),e._v(" at the top-level (the very first contract being called) is always equal to "),t("code",[e._v("tx.origin")]),e._v(".\nTherefore, if the value of "),t("code",[e._v("tx.origin")]),e._v(" is affected by the rules defined above, the top-level value of "),t("code",[e._v("msg.sender")]),e._v(" will also be impacted.")]),e._v(" "),t("p",[e._v("Note that in general, "),t("a",{attrs:{href:"https://docs.soliditylang.org/en/latest/security-considerations.html#tx-origin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("tx.origin")]),e._v(" should "),t("em",[e._v("not")]),e._v(" be used for authorization"),t("OutboundLink")],1),e._v(".\nHowever, that is a separate issue from address aliasing because address aliasing also affects "),t("code",[e._v("msg.sender")]),e._v(".")]),e._v(" "),t("h4",{attrs:{id:"why-is-address-aliasing-an-issue-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#why-is-address-aliasing-an-issue-2"}},[e._v("#")]),e._v(" Why is address aliasing an issue?")]),e._v(" "),t("p",[e._v("The problem with two identical source addresses (the L1 contract and the L2 contract) is that we extend trust based on the address.\nIt is possible that we will want to trust one of the contracts, but not the other.")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Helena Hacker forks "),t("a",{attrs:{href:"https://uniswap.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Uniswap"),t("OutboundLink")],1),e._v(" to create her own exchange (on L2), called Hackswap.")]),e._v(" "),t("p",[t("strong",[e._v("Note:")]),e._v(" There are actually multiple contracts in Uniswap, so this explanation is a bit simplified.\n"),t("a",{attrs:{href:"https://ethereum.org/en/developers/tutorials/uniswap-v2-annotated-code/",target:"_blank",rel:"noopener noreferrer"}},[e._v("See here if you want additional details"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("li",[t("p",[e._v("Helena Hacker provides Hackswap with liquidity that appears to allow for profitable arbitrage opportunities.\nFor example, she can make it so that you can spend 1 "),t("a",{attrs:{href:"https://www.coindesk.com/price/dai/",target:"_blank",rel:"noopener noreferrer"}},[e._v("DAI"),t("OutboundLink")],1),e._v("to buy 1.1 "),t("a",{attrs:{href:"https://www.coindesk.com/price/tether/",target:"_blank",rel:"noopener noreferrer"}},[e._v("USDT"),t("OutboundLink")],1),e._v(".\nBoth of those coins are supposed to be worth exactly $1.")])]),e._v(" "),t("li",[t("p",[e._v("Nimrod Naive knows that if something looks too good to be true it probably is.\nHowever, he checks the Hackswap contract's bytecode and verifies it is 100% identical to Uniswap.\nHe decides this means the contract can be trusted to behave exactly as Uniswap does.")])]),e._v(" "),t("li",[t("p",[e._v("Nimrod approves an allowance of 1000 DAI for the Hackswap contract.\nNimrod expects to call the swap function on Hackswap and receive back nearly 1100 USDT.")])]),e._v(" "),t("li",[t("p",[e._v("Before Nimrod's swap transaction is sent to the blockchain, Helena Hacker sends a transaction from an L1 contract with the same address as Hackswap.\nThis transaction transfers 1000 DAI from Nimrod's address to Helena Hacker's address.\nIf this transaction were to come from the same address as Hackswap on L2, it would be able to transfer the 1000 DAI because of the allowance Nimrod "),t("em",[e._v("had")]),e._v(" to give Hackswap in the previous step to swap tokens.")]),e._v(" "),t("p",[e._v("Nimrod, despite his naivete, is protected because Optimism modified the transaction's "),t("code",[e._v("tx.origin")]),e._v(" (which is also the initial "),t("code",[e._v("msg.sender")]),e._v(").\nThat transaction comes from a "),t("em",[e._v("different")]),e._v(" address, one that does not have the allowance.")])])]),e._v(" "),t("p",[t("strong",[e._v("Note:")]),e._v(" It is simple to create two different contracts on the same address in different chains.\nBut it is nearly impossible to create two that are different by a specified amount, so Helena Hacker can't do that.")])]),e._v(" "),t("h2",{attrs:{id:"blocks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#blocks"}},[e._v("#")]),e._v(" Blocks")]),e._v(" "),t("p",[e._v("There are several differences in the way blocks are produced between L1 Ethereum and Optimism Bedrock.")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Parameter")]),e._v(" "),t("th",[e._v("L1 Ethereum")]),e._v(" "),t("th",[e._v("Optimism Bedrock")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("Time between blocks")]),e._v(" "),t("td",[e._v("12 seconds(1)")]),e._v(" "),t("td",[e._v("2 seconds")])]),e._v(" "),t("tr",[t("td",[e._v("Block target size")]),e._v(" "),t("td",[e._v("15,000,000 gas")]),e._v(" "),t("td",[e._v("to be determined")])]),e._v(" "),t("tr",[t("td",[e._v("Block maximum size")]),e._v(" "),t("td",[e._v("30,000,000 gas")]),e._v(" "),t("td",[e._v("to be determined")])])])]),e._v(" "),t("p",[e._v("(1) This is the ideal.\nIf any blocks are missed it could be an integer multiple such as 24 seconds, 36 seconds, etc.")]),e._v(" "),t("p",[t("strong",[e._v("Note:")]),e._v(" The L1 Ethereum parameter values are taken from "),t("a",{attrs:{href:"https://ethereum.org/en/developers/docs/blocks/#block-time",target:"_blank",rel:"noopener noreferrer"}},[e._v("ethereum.org"),t("OutboundLink")],1),e._v(". The Optimism Bedrock values are taken from "),t("a",{attrs:{href:"https://github.com/ethereum-optimism/optimism/blob/develop/specs/guaranteed-gas-market.md#limiting-guaranteed-gas",target:"_blank",rel:"noopener noreferrer"}},[e._v("the Optimism specs"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"network-specifications-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#network-specifications-2"}},[e._v("#")]),e._v(" Network specifications")]),e._v(" "),t("h3",{attrs:{id:"json-rpc-differences-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#json-rpc-differences-2"}},[e._v("#")]),e._v(" JSON-RPC differences")]),e._v(" "),t("p",[e._v("Optimism uses the same "),t("a",{attrs:{href:"https://eth.wiki/json-rpc/API",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON-RPC API"),t("OutboundLink")],1),e._v(" as Ethereum.\nSome additional Optimism specific methods have been introduced.\nSee the full list of "),t("RouterLink",{attrs:{to:"/docs/rollux-developers/build/json-rpc.html"}},[e._v("custom JSON-RPC methods")]),e._v(" for more information.")],1),e._v(" "),t("h3",{attrs:{id:"pre-eip-155-support-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pre-eip-155-support-2"}},[e._v("#")]),e._v(" Pre-EIP-155 support")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://eips.ethereum.org/EIPS/eip-155",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pre-EIP-155"),t("OutboundLink")],1),e._v(" transactions do not have a chain ID, which means a transaction on one Ethereum blockchain can be replayed on others.\nThis is a security risk.\nStarting in November 2022, pre-EIP-155 transactions are no longer supported on Optimism.")]),e._v(" "),t("h2",{attrs:{id:"transaction-costs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#transaction-costs"}},[e._v("#")]),e._v(" Transaction costs")]),e._v(" "),t("p",[t("RouterLink",{attrs:{to:"/docs/rollux-developers/build/transaction-fees.html"}},[e._v("Transaction costs on Optimism")]),e._v(" include an "),t("RouterLink",{attrs:{to:"/docs/rollux-developers/build/transaction-fees.html#the-l2-execution-fee"}},[e._v("L2 execution fee")]),e._v(" and an "),t("RouterLink",{attrs:{to:"/docs/rollux-developers/build/transaction-fees.html#the-l1-data-fee"}},[e._v("L1 data fee")]),e._v(".")],1),e._v(" "),t("h2",{attrs:{id:"contract-addresses"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#contract-addresses"}},[e._v("#")]),e._v(" Contract addresses")]),e._v(" "),t("p",[e._v("The addresses in which various infrastructure contracts are installed are different between L1 Ethereum and Optimism.\nFor example, "),t("a",{attrs:{href:"https://github.com/gnosis/canonical-weth/blob/master/contracts/WETH9.sol",target:"_blank",rel:"noopener noreferrer"}},[e._v("WETH9"),t("OutboundLink")],1),e._v(" is installed on L1 Ethereum on "),t("a",{attrs:{href:"https://etherscan.io/address/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",target:"_blank",rel:"noopener noreferrer"}},[e._v("address "),t("code",[e._v("0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2")]),t("OutboundLink")],1),e._v(".\nOn Optimism the same contract is installed on "),t("a",{attrs:{href:"https://explorer.optimism.io/address/0x4200000000000000000000000000000000000006",target:"_blank",rel:"noopener noreferrer"}},[e._v("address "),t("code",[e._v("0x4200000000000000000000000000000000000006")]),t("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=r.exports}}]);